blueprint:
  name: Simulador de Presença com Interruptores
  description: Simula presença ligando interruptores aleatoriamente durante um período específico
  domain: automation
  input:
    switches:
      name: Interruptores
      description: Selecione os interruptores que serão usados na simulação
      selector:
        entity:
          multiple: true
          filter:
            domain: switch
    start_time:
      name: Horário de Início
      description: Horário para iniciar a simulação de presença
      selector:
        time:
      default: "18:00:00"
    end_time:
      name: Horário de Término
      description: Horário para encerrar a simulação de presença
      selector:
        time:
      default: "23:00:00"
    min_interval:
      name: Intervalo Mínimo (minutos)
      description: Tempo mínimo entre mudanças de estado dos interruptores
      selector:
        number:
          min: 1
          max: 60
          unit_of_measurement: "min"
      default: 5
    max_interval:
      name: Intervalo Máximo (minutos)
      description: Tempo máximo entre mudanças de estado dos interruptores
      selector:
        number:
          min: 1
          max: 120
          unit_of_measurement: "min"
      default: 15
    monday:
      name: Segunda-feira
      description: Ativar simulação na Segunda-feira
      selector:
        boolean:
      default: true
    tuesday:
      name: Terça-feira
      description: Ativar simulação na Terça-feira
      selector:
        boolean:
      default: true
    wednesday:
      name: Quarta-feira
      description: Ativar simulação na Quarta-feira
      selector:
        boolean:
      default: true
    thursday:
      name: Quinta-feira
      description: Ativar simulação na Quinta-feira
      selector:
        boolean:
      default: true
    friday:
      name: Sexta-feira
      description: Ativar simulação na Sexta-feira
      selector:
        boolean:
      default: true
    saturday:
      name: Sábado
      description: Ativar simulação no Sábado
      selector:
        boolean:
      default: true
    sunday:
      name: Domingo
      description: Ativar simulação no Domingo
      selector:
        boolean:
      default: true

mode: restart
max_exceeded: silent

trigger:
  - platform: time
    at: !input start_time

condition:
  - condition: or
    conditions:
      - condition: and
        conditions:
          - condition: time
            weekday: mon
          - condition: template
            value_template: "{{ monday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: tue
          - condition: template
            value_template: "{{ tuesday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: wed
          - condition: template
            value_template: "{{ wednesday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: thu
          - condition: template
            value_template: "{{ thursday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: fri
          - condition: template
            value_template: "{{ friday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: sat
          - condition: template
            value_template: "{{ saturday }}"
      - condition: and
        conditions:
          - condition: time
            weekday: sun
          - condition: template
            value_template: "{{ sunday }}"

action:
  - repeat:
      while:
        - condition: time
          after: !input start_time
          before: !input end_time
      sequence:
        - variables:
            selected_switches: !input switches
            random_switch: "{{ selected_switches | random }}"
            random_action: "{{ ['turn_on', 'turn_off'] | random }}"
            min_wait: !input min_interval
            max_wait: !input max_interval
            random_delay: "{{ range(min_wait, max_wait + 1) | random }}"
        
        - service: "switch.{{ random_action }}"
          target:
            entity_id: "{{ random_switch }}"
        
        - delay:
            minutes: "{{ random_delay }}"
  
  - service: switch.turn_off
    target:
      entity_id: !input switches
